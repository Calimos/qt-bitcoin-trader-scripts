[JLScript]
Version=1
Name=TraderMain
Notes=
Encrypted=false
LogRowsCount=300
Data="var variablePath = \"C:\\\\Users\\\\Damjan\\\\Documents\\\\GitHub\\\\qt-bitcoin-trader-scripts\\\\\";\n\n///////////////\t\tlog to file or window\t\t///////////////////\nvar logToFile = true;\nvar logToWindow = true;\nvar logFile = variablePath + \"TraderMainLogger.txt\";\n\nfunction eventLogger(tempString) {\n    if (logToFile)\n        trader.fileAppend(logFile, trader.dateTimeString() + \": \" + tempString);\n    if (logToWindow)\n        trader.log(tempString);\n}\n\n\nvar lastTradeStatusFile = variablePath + \"lastTradeStatusFile.txt\";\n\neventLogger(\"///////////////////////        START - TRADER MAIN       ///////////////////\");\n///////////////////////////////////////////////////////////////////\nlastMyBuyPrice();\ntrader.timer(57, \"lastMyBuyPrice()\");\n///////////////////////////////////////////////////////////////////\nvar currencyPrimary = \"USD\";\nvar currencySecondary = \"BTC\";\n\n// in%,the first step indentation How price first buy order in the table should be less than the purchase of the current at the time of the calculation table.  All other orders will buy more cheaper //default 0.5\nvar otstupFile = variablePath + \"firstBuyStep.txt\";\nvar otstup = parseFloat(trader.fileReadAll(otstupFile));\nvar scriptName = \"\";\neventLogger(scriptName + \".otstup: \" + otstup);\n///////////////////////////////////////////////////////////////////\n//maxNumberOfBids.txt\nvar ordersFile = variablePath + \"maxNumberOfBids.txt\";\nvar orders = parseFloat(trader.fileReadAll(ordersFile)); // 2 to 20,how many buy-to place orders in the amount of overlap. //default 13\neventLogger(scriptName + \".orders: \" + orders);\n///////////////////////////////////////////////////////////////////\n//StepBetweenOrders.txt\nvar perekrFile = variablePath + \"StepBetweenOrders.txt\";\nvar perekr = parseFloat(trader.fileReadAll(perekrFile)); // in% overlap stroke rates,calculating the depth of the table buy orders.  For example,in a first step,the price 10ETH percentage of overlap of 20% means that the table will be set in the range // 8-10ETH.  //default 30\neventLogger(scriptName + \".perekr: \" + perekr);\n///////////////////////////////////////////////////////////////////\n//Profit.txt\nvar profitFile = variablePath + \"Profit.txt\";\nvar profit = parseFloat(trader.fileReadAll(profitFile)); // in%,profit,profit How to lay into each sell order. \neventLogger(scriptName + \".profit: \" + profit);\n///////////////////////////////////////////////////////////////////\n//Margin.txt\nvar martinFile = variablePath + \"martinStep.txt\";\nvar martin = parseFloat(trader.fileReadAll(martinFile)); // in%,martingale,when calculating each table buy orders following order cheaper by volume greater than the previous to this value.  //default 15\neventLogger(scriptName + \".martin: \" + martin);\n///////////////////////////////////////////////////////////////////\n\nvar lastSaleFile = variablePath + \"lastSale.txt\";\nvar lastMySellPriceOld = trader.get(\"LastMySellPrice\");\neventLogger(scriptName + \".lastMySellPrice: \" + lastMySellPriceOld);\ntrader.fileWrite(lastSaleFile, lastMySellPriceOld);\n\n///////////////////////////////////////////////////////////////////\n//var lastCurrencySecondaryBallanceFile = variablePath + \"lastCurrencySecondaryBallance.txt\";\nvar currencySecondaryBalance = trader.get(\"Balance\", currencySecondary);\neventLogger(scriptName + \".currencySecondaryBalance: \" + currencySecondaryBalance);\n//trader.fileWrite(lastCurrencySecondaryBallanceFile, currencySecondaryBalance);\n\n///////////////////////////////////////////////////////////////////\nvar bidPriceFile = variablePath + \"bidPrice.txt\";\nvar bidPrice = trader.get(\"BidPrice\");\neventLogger(scriptName + \".bidPrice: \" + bidPrice);\ntrader.fileWrite(bidPriceFile, bidPrice);\n\n\nvar perekrDif = 0.25;\nvar martinDif = 0.1;\nvar openBidsCount = 0;\nvar openAsksCount = trader.get(\"OpenAsksCount\");\nvar openAsksCountOld = openAsksCount;\n\neventLogger(scriptName + \".Restart Trader\");\ntrader.groupStop(\"Trader\");\ntrader.groupStart(\"Trader\");\n\ntrader.timer(41, \"restartEverything()\");\n\nfunction restartEverything() {\n    var scriptName = \"restartEverything()\";\n    eventLogger(scriptName + \".START\");\n    \n    openAsksCount = trader.get(\"OpenAsksCount\");\n    var lastMySellPrice = trader.get(\"LastMySellPrice\");\n    eventLogger(scriptName + \".lastMySellPriceOld: \" + lastMySellPrice);\n    eventLogger(scriptName + \".lastMySellPrice: \" + lastMySellPriceOld);\n    eventLogger(scriptName + \".openAsksCount: \" + openAsksCount);\n    eventLogger(scriptName + \".openAsksCountOld: \" + openAsksCountOld);\t\n\t\n\tif(openAsksCount < openAsksCountOld)\n\t{\t\t\n\t\t\teventLogger(scriptName + \".STEP0\");\n\t\t\trestartTraderMainRestart();\n\t}\n\t\n    if (lastMySellPrice != lastMySellPriceOld) {\n        eventLogger(scriptName + \".STEP1\");        \n        restartTraderMainRestart();\n\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\t\t\t\t\t\t\t\t\t   \n    } else {\n        eventLogger(scriptName + \".STEP2\");\n        bidPrice = trader.get(\"BidPrice\");\n        eventLogger(scriptName + \".bidPrice: \" + bidPrice);\n        trader.fileWrite(bidPriceFile, bidPrice);\n\n        currencySecondaryBalance = trader.get(\"Balance\", currencySecondary);\n        eventLogger(scriptName + \".currencySecondaryBalance: \" + currencySecondaryBalance);\n        //trader.fileWrite(lastCurrencySecondaryBallanceFile, currencySecondaryBalance);\n\n        openBidsCount = trader.get(\"OpenBidsCount\");\n        openAsksCount = trader.get(\"OpenAsksCount\");\n        eventLogger(scriptName + \".openBidsCount: \" + openBidsCount);\n        eventLogger(scriptName + \".openAsksCount: \" + openAsksCount);\n        eventLogger(scriptName + \".openAsksCountOld: \" + openAsksCountOld);\n\n        \n        if ((((openAsksCount < openAsksCountOld) || (openAsksCount == openAsksCountOld && lastMySellPriceOld != 0)) && lastMySellPriceOld != lastMySellPrice)) {\n        //if (((openAsksCount < openAsksCountOld) || (openAsksCount == openAsksCountOld && lastMySellPriceOld != 0)) && openAsksCount < openAsksCountOld) {\n            eventLogger(scriptName + \".STEP3\");\n\n            //perekr += perekrDif;\n            //trader.fileWrite(perekrFile,perekr);\n\n            //martin += martinDif;\n            //trader.fileWrite(martinFile,martin);\n\n            //trader.log(\"VAL[restartEverything.otstup]: \", otstup);\n            //otstup = 0;\n            //trader.fileWrite(otstupFile,otstup);\n            \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n            lastMySellPriceOld = lastMySellPrice;\n            trader.fileWrite(lastSaleFile, lastMySellPriceOld);            \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   \n            trader.cancelBids(currencySecondary + currencyPrimary);\n            restartTraderMainRestart();\n\t\t\t\t\t\t\t\t\t\t\t\t   \n        }\n\n\n        /*if(openBidsCount != orders && ((orders - openBidsCount) > 1))\n        {\n        \teventLogger(scriptName + \".STEP4\");\n\t\t\n        \t//trader.log(\"VAL[restartEverything.perekr]: \", perekr);\n        \t//perekr -= perekrDif;\n        \t//trader.fileWrite(perekrFile,perekr);\n        \t\n        \t//trader.log(\"VAL[restartEverything.martin]: \", martin);\n        \t//martin -= martinDif;\n        \t//trader.fileWrite(martinFile,martin);\n\t\t\n        \t//trader.groupStop(\"Trader\");\n        \t//trader.groupStart(\"Trader\");\n        \torders = openBidsCount;\n        }\n        */\n\n        //orders = openBidsCount;        \n\t\t\t\t\t\t\t\t\t\t \n    }\n\topenAsksCountOld = openAsksCount;\n    eventLogger(scriptName + \".END\");\n}\n\nfunction restartTraderMainRestart()\n{\n\tvar scriptName = \"restartTraderMainRestart()\";\n    eventLogger(scriptName + \".START\");\n    eventLogger(scriptName + \"./#/#/#/#////////////   RESTART   ////////////////////\");\n    eventLogger(scriptName + \".SELL.lastTradeStatusFile\");\n    trader.fileWrite(lastTradeStatusFile, \"SELL\");\n    eventLogger(scriptName + \".STOP.TraderMainRestart\");\n    trader.groupStop(\"TraderMainRestart\");\n    eventLogger(scriptName + \".STOP.Trader\");\n    trader.groupStop(\"Trader\");\n    eventLogger(scriptName + \".START.TraderMainRestart\");\t\n    trader.groupStart(\"TraderMainRestart\");\n    eventLogger(scriptName + \".Start.TraderMain\");\n\ttrader.groupStop(\"TraderMain\");\n\t\n\teventLogger(scriptName + \".END\");\n}\n\nfunction lastMyBuyPrice() {\n    var scriptName = \"lastMyBuyPrice()\";\n    eventLogger(scriptName + \".START\");\n    trader.groupStop(\"TraderLastBuy\");\n    trader.groupStart(\"TraderLastBuy\");\n    eventLogger(scriptName + \".END\");\n}"
