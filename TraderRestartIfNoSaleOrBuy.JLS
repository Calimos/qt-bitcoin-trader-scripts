[JLScript]
Version=1
Name=TraderRestartIfNoSaleOrBuy
Notes=
Encrypted=false
LogRowsCount=500
Data="var variablePath = \"C:\\\\Users\\\\Damjan\\\\Documents\\\\GitHub\\\\qt-bitcoin-trader-scripts\\\\\";\n///////////////\t\tlog to file or window\t\t///////////////////\nvar logToFile = true;\nvar logToWindow = true;\nvar logFile = variablePath + \"TraderRestartIfNoSaleOrBuy.txt\";\n\nfunction eventLogger(tempString) {\n    if (logToFile)\n        trader.fileAppend(logFile, trader.dateTimeString() + \": \" + tempString);\n    if (logToWindow)\n        trader.log(tempString);\n}\n///////////\t\twrite last bid price\t///////////////////////////\n\nvar lastMySellPrice = 0;\nvar lastMySellPriceOld = trader.get(\"LastMySellPrice\");\nvar lastMyBuyPrice = 0;\nvar lastMyBuyPriceOld = trader.get(\"LastMyBuyPrice\");\nvar restartBuyDiffValue = 0.5;\nvar restartScripts = false;\nvar buyAbsDiff = 0;\nvar lastPrice = 0;\nvar resetPercentage = 0.3;\n\n///////////////////////////////////////////////////////////////////\nvar resetPriceFile = variablePath + \"resetPrice.txt\";\nvar resetPrice = parseFloat(trader.fileReadAll(resetPriceFile));\n///////////////////////////////////////////////////////////////////\nvar resetBidsEnabledFile = variablePath + \"resetBidsEnabled.txt\";\nvar resetBidsEnabled = trader.fileReadAll(resetBidsEnabledFile).toString().trim();\n///////////////////////////////////////////////////////////////////\nvar raznostInPercentageFile = variablePath + \"raznostInPercentage.txt\";\nvar raznostInPercentage = parseFloat(trader.fileReadAll(raznostInPercentageFile));\n\nvar raznostInPercentageConditionFile = variablePath + \"raznostInPercentageCondition.txt\";\nvar raznostInPercentageCondition = trader.fileReadAll(raznostInPercentageConditionFile).toString().trim();\n///////////////////////////////////////////////////////////////////\n\ntrader.timer(600, \"restartEverything()\");\n\nfunction restartEverything() {\n    var scriptName = \"restartEverything()\";\n    eventLogger(scriptName + \".START\");\n\n    trader.log(\"CHECK.STEP1\");\n    lastMySellPrice = trader.get(\"LastMySellPrice\");\n    lastMyBuyPrice = trader.get(\"LastMyBuyPrice\");\n    lastPrice = trader.get(\"LastPrice\");\n    trader.log(\"LastMySellPrice: \" + lastMySellPrice);\n    trader.log(\"LastMySellPriceOld: \" + lastMySellPriceOld);\n    trader.log(\"LastMyBuyPrice: \" + lastMyBuyPrice);\n    trader.log(\"LastMyBuyPriceOld: \" + lastMyBuyPriceOld);\n    buyAbsDiff = Math.abs(lastMyBuyPrice - lastPrice);\n    checkBuyAbsDiff();\n\n    if (lastMySellPrice == lastMySellPriceOld && lastMyBuyPrice == lastMyBuyPriceOld) {\n        trader.log(\"resetBidsEnabled: \" + resetBidsEnabled);\n        if (resetBidsEnabled == \"true\") {\n            trader.log(\"STEP 1\");\n            trader.log(\"restartScripts: \" + restartScripts);\n            if (restartScripts == true) {\n                trader.log(\"STEP 2\");\n                trader.log(\"RESTART\");\n                trader.groupStop(\"TraderMainRestart\");\n                trader.groupStart(\"TraderMainRestart\");\n            }\n        } else {\n            trader.log(\"STEP 3\");\n            trader.log(\"RESTART\");\n            trader.groupStop(\"TraderMainRestart\");\n            trader.groupStart(\"TraderMainRestart\");\n        }\n\n    }\n    trader.log(\"CHECK.STEP2\");\n    lastMySellPriceOld = lastMySellPrice;\n    lastMyBuyPriceOld = lastMyBuyPrice;\n\n    trader.log(\"LastMySellPrice: \" + lastMySellPrice);\n    trader.log(\"LastMySellPriceOld: \" + lastMySellPriceOld);\n    trader.log(\"LastMyBuyPrice: \" + lastMyBuyPrice);\n    trader.log(\"LastMyBuyPriceOld: \" + lastMyBuyPriceOld);\n\n    trader.groupStop(\"Test script\");\n    trader.groupStart(\"Test script\");\n    eventLogger(scriptName + \".STOP\");\n}\n\nfunction restartEverything() {\n    var scriptName = \"restartEverything()\";\n    eventLogger(scriptName + \".START\");\n\n    if (raznostInPercentageCondition == \"true\") {\n        trader.log(scriptName + \".STEP\");\n        var tempDiff = 0;\n        if (lastMyBuyPrice < lastPrice) {\n            trader.log(scriptName + \".STEP1.1\");\n            tempDiff = Math.pow((lastMyBuyPrice / lastPrice), -1) - 1;\n            trader.log(\"tempDiff: \" + tempDiff);\n            trader.log(\"resetPercentage: \" + resetPercentage);\n            if (tempDiff > resetPercentage)\n            {\n                trader.log(scriptName + \".STEP1.2\");\n                restartScripts = true;\n                trader.log(\"restartScripts: \" + restartScripts);\n            }\n            \n        } else {\n            trader.log(scriptName + \".STEP2.1\");\n            tempDiff = Math.pow((lastPrice / lastMyBuyPrice), -1) - 1;\n            trader.log(\"tempDiff: \" + tempDiff);\n            trader.log(\"raznostInPercentage: \" + raznostInPercentage);\n            if (tempDiff > raznostInPercentage)\n            {\n                trader.log(scriptName + \".STEP2.2\");\n                restartScripts = true;\n                trader.log(\"restartScripts: \" + restartScripts);\n            }\n        }\n\n    }\n    eventLogger(scriptName + \".END\");\n}"
