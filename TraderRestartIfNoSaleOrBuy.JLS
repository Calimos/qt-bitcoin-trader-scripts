[JLScript]
Version=1
Name=TraderRestartIfNoSaleOrBuy
Notes=
Encrypted=false
LogRowsCount=499
Data="var variablePath = \"C:\\\\Users\\\\Damjan\\\\Documents\\\\GitHub\\\\qt-bitcoin-trader-scripts\\\\\";\n///////////////\t\tlog to file or window\t\t///////////////////\nvar logToFile = true;\nvar logToWindow = true;\nvar logFile = variablePath + \"TraderRestartIfNoSaleOrBuy.txt\";\n\nfunction eventLogger(tempString) {\n    if (logToFile)\n        trader.fileAppend(logFile, trader.dateTimeString() + \": \" + tempString);\n    if (logToWindow)\n        trader.log(tempString);\n}\n///////////\t\twrite last bid price\t///////////////////////////\n\nvar lastMySellPrice = 0;\nvar lastMySellPriceOld = trader.get(\"LastMySellPrice\");\nvar lastMyBuyPrice = 0;\nvar lastMyBuyPriceOld = trader.get(\"LastMyBuyPrice\");\nvar restartBuyDiffValue = 0.5;\nvar restartScripts = false;\nvar buyAbsDiff = 0;\nvar lastPrice = 0;\nvar resetPercentage = 0.3;\n\n///////////////////////////////////////////////////////////////////\nvar resetPriceFile = variablePath + \"resetPrice.txt\";\nvar resetPrice = parseFloat(trader.fileReadAll(resetPriceFile));\n///////////////////////////////////////////////////////////////////\nvar resetBidsEnabledFile = variablePath + \"resetBidsEnabled.txt\";\nvar resetBidsEnabled = trader.fileReadAll(resetBidsEnabledFile).toString().trim();\n///////////////////////////////////////////////////////////////////\nvar raznostInPercentageFile = variablePath + \"raznostInPercentage.txt\";\nvar raznostInPercentage = parseFloat(trader.fileReadAll(raznostInPercentageFile));\n\nvar raznostInPercentageConditionFile = variablePath + \"raznostInPercentageCondition.txt\";\nvar raznostInPercentageCondition = trader.fileReadAll(raznostInPercentageConditionFile).toString().trim();\n///////////////////////////////////////////////////////////////////\n\ntrader.timer(300, \"restartEverything()\");\n\nfunction restartEverything() {\n    var scriptName = \"restartEverything()\";\n    eventLogger(scriptName + \".START\");\n\n    eventLogger(scriptName + \".STEP 0\");\n    lastMySellPrice = trader.get(\"LastMySellPrice\");\n    lastMyBuyPrice = trader.get(\"LastMyBuyPrice\");\n    lastPrice = trader.get(\"LastPrice\");\n    eventLogger(scriptName + \".LastMySellPrice: \" + lastMySellPrice);\n    eventLogger(scriptName + \".LastMySellPriceOld: \" + lastMySellPriceOld);\n    eventLogger(scriptName + \".LastMyBuyPrice: \" + lastMyBuyPrice);\n    eventLogger(scriptName + \".LastMyBuyPriceOld: \" + lastMyBuyPriceOld);\n    buyAbsDiff = Math.abs(lastMyBuyPrice - lastPrice);\n    checkBuyAbsDiff();\n\n    if (lastMySellPrice == lastMySellPriceOld && lastMyBuyPrice == lastMyBuyPriceOld) {\n        eventLogger(scriptName + \".resetBidsEnabled: \" + resetBidsEnabled);\n        if (resetBidsEnabled == \"true\") {\n            eventLogger(scriptName + \".STEP 1\");\n            eventLogger(scriptName + \".restartScripts: \" + restartScripts);\n            if (restartScripts == true) {\n                eventLogger(scriptName + \".STEP 2\");\n                eventLogger(scriptName + \".RESTART -----------------------------------------\");\n                trader.groupStop(\"TraderMainRestart\");\n                trader.groupStart(\"TraderMainRestart\");\n            }\n        } else {\n            eventLogger(scriptName + \".STEP 3\");\n            eventLogger(scriptName + \".RESTART -----------------------------------------\");\n            trader.groupStop(\"TraderMainRestart\");\n            trader.groupStart(\"TraderMainRestart\");\n        }\n\n    }\n    lastMySellPriceOld = lastMySellPrice;\n    lastMyBuyPriceOld = lastMyBuyPrice;\n\n    eventLogger(scriptName + \".LastMySellPrice: \" + lastMySellPrice);\n    eventLogger(scriptName + \".LastMySellPriceOld: \" + lastMySellPriceOld);\n    eventLogger(scriptName + \".LastMyBuyPrice: \" + lastMyBuyPrice);\n    eventLogger(scriptName + \".LastMyBuyPriceOld: \" + lastMyBuyPriceOld);\n\n    trader.groupStop(\"Test script\");\n    trader.groupStart(\"Test script\");\n    eventLogger(scriptName + \".STOP\");\n}\n\nfunction checkBuyAbsDiff() {\n    var scriptName = \"checkBuyAbsDiff()\";\n    eventLogger(scriptName + \".START\");\n    eventLogger(scriptName + \".lastMyBuyPrice: \" + lastMyBuyPrice);\n    eventLogger(scriptName + \".lastPrice: \" + lastPrice);\n\n    if (raznostInPercentageCondition == \"true\") {\n        eventLogger(scriptName + \".STEP 0\");\n        var tempDiff = 0;\n        var tempValue = 0;\n        if (lastMyBuyPrice < lastPrice) {\n            eventLogger(scriptName + \".STEP1.1\");\n            tempValue = lastMyBuyPrice / lastPrice;\n            eventLogger(scriptName + \".tempValue: \" + tempValue);\n            tempDiff = Math.pow(tempValue, -1) - 1;\n            eventLogger(scriptName + \".tempDiff: \" + tempDiff);\n            eventLogger(scriptName + \".resetPercentage: \" + resetPercentage);\n            if (tempDiff > resetPercentage) {\n                eventLogger(scriptName + \".STEP1.2\");\n                restartScripts = true;\n                eventLogger(scriptName + \".restartScripts: \" + restartScripts);\n            }\n\n        } else {\n            eventLogger(scriptName + \".STEP2.1\");\n            tempValue = lastPrice / lastMyBuyPrice;\n            eventLogger(scriptName + \".tempValue: \" + tempValue);\n            tempDiff = Math.pow(tempValue, -1) - 1;\n            eventLogger(scriptName + \".tempDiff: \" + tempDiff);\n            eventLogger(scriptName + \".raznostInPercentage: \" + raznostInPercentage);\n            if (tempDiff > raznostInPercentage) {\n                eventLogger(scriptName + \".STEP2.2\");\n                restartScripts = true;\n                eventLogger(scriptName + \".restartScripts: \" + restartScripts);\n            }\n        }\n\n    }\n    eventLogger(scriptName + \".END\");\n}"
